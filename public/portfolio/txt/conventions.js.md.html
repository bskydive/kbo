<h1 id="-javascript-dom-bom">Соглашения про javaScript, DOM, BOM</h1>
<h2 id="-"><a href="/txt/conventions.md.html">Соглашения</a></h2>
<h2 id="-javascript-dom-bom"><a href="/txt/conventions.js.md.html">Соглашения про javaScript, DOM, BOM</a></h2>
<h2 id="-less-css"><a href="/txt/conventions.less.md.html">Соглашения про LESS/CSS</a></h2>
<h2 id="-"><a href="/txt/conventions.angular.md.html">Соглашения про Ангуляр</a></h2>
<h2 id="-vue"><a href="/txt/conventions.vue.md.html">Соглашения про VUE</a></h2>
<h2 id="-"><a href="/txt/conventions.draft.md.html">Соглашения - черновик</a></h2>
<h2 id="-">События</h2>
<ol>
<li><p>В chrome заблокирован вывод window.confirm по событию закрытия вкладки. 
 Поэтому, выполняем <a href="https://stackoverflow.com/questions/7794301/window-onunload-is-not-working-properly-in-chrome-browser-can-any-one-help-me">хак</a></p>
<pre><code class="lang-js"> $window.onbeforeunload = function (event)
                             {
                                 $scope.openModalAutoComplete();
                                 return &#39;Необходимо ваше внимание&#39;;
                             };
</code></pre>
</li>
<li><p>Перменные необходимо называть существительными, описывающими их назначение(содержимое), &quot;верблюжьим&quot;(camelCase) регистром.</p>
<pre><code class="lang-js"> let applicantSurName = &#39;&#39;;
</code></pre>
</li>
<li><p>Названия логических(boolean) переменных необходимо начинать с <code>is</code></p>
<pre><code class="lang-js"> let isModalVisible = false;
</code></pre>
</li>
<li><p>Константы необходимо именовать в верхнем регистре(заглавными). Разделитель - подчёркивание.</p>
<pre><code class="lang-js"> const NUMBER_VOCABULARY_POSITION = 888;

</code></pre>
</li>
<li><p>Числовые значения не обозначающие количество/порядковый номер необходимо объявлять как константы для удобства чтения.</p>
<p> Неверно:</p>
<pre><code class="lang-js">     if (user.type === 888) {}
</code></pre>
<p> Верно:</p>
<pre><code class="lang-js">     const USER_TYPE_RECRUITER = 888;
     if (user.type === USER_TYPE_RECRUITER) {}
</code></pre>
</li>
<li><p>Константы, логически отосящиеся к сервисам необходимо объявлять внутри них для сокращения кода.</p>
<pre><code class="lang-js">     if (user.type === authService.USER_TYPE_RECRUITER) {}
</code></pre>
</li>
<li><p>При написании и правке кода необходимо убирать ненужные комментарии и console.log</p>
</li>
<li><p>Использовать для логирования на продуктиве <code>src/app/common/services/error-service.js</code> вместо console.log</p>
<p> Пример:</p>
<pre><code class="lang-js">      errorService.error(
      error,
      &#39;Ошибка при сохранении позиции applicantService.positionName&#39;,
      {isUseLogger: true},
      &#39;warning&#39;,
      &#39;src/app/applicant/profile/profile-controller.js&#39;,
      &#39;initUser.openModalOnMouseLeave--&gt;applicantService.update&#39;,
      &#39;PG-1481&#39;
  );
</code></pre>
</li>
<li><p>При рефакторинге кода необходимо <a href="http://usejsdoc.org/">описывать функции</a> для удобства чтения.
 Если потратили время на разбор, то необходимо сохранить и переиспользовтаь результаты труда.</p>
<p> пример:</p>
<pre><code class="lang-js"> /**
     * Что делает функция с точки зрения бизнес-логики, а не перечисление названий переменных.
      * Крайне желательно указать где её вызывают
      * Крайне желательно описать формат объектов переменных на вход и выход 
     *
     * @param {тип_данных} название_входного_параметра - описание возможных вариантов значений
     * @return {тип_данных} -  описание возможных вариантов значений
     */

</code></pre>
</li>
</ol>
<ol>
<li><p>Функции с возвратом промиссов должны возвращать одинаковый тип данных</p>
<p> Верно:</p>
<pre><code class="lang-js"> function fun1(){
     if (var1){    
         return service1.fun2()
                     .then(data =&gt; {
                         //...
                         resolve(data);
                     })
                     .catch(error =&gt; {
                         //...
                         reject(error);
                     });
     } else {
         return Promise.reject(false);//либо id ошибки внутри объекта аналогичного error
     }
 };
</code></pre>
<p> НеВерно:</p>
<pre><code class="lang-js"> function fun1(){
     if (var1){
         return service1.fun2()
                             .then(data =&gt; {
                                 //...
                                 resolve(data);
                             });
        } else {
            reject(&#39;error text&#39;);
       }
 };
</code></pre>
</li>
<li><p>В код вывода в консоль при отладке необходимо вставлять указание на место вызова, чтобы быстрее удалять ненужный код.
 В intellij* IDE это ctrl+shift+alt+c, ctrl+v</p>
<pre><code class="lang-js"> console.log(&#39;src/app/main/login/login-modal-controller.js:68&#39;,user);

</code></pre>
</li>
<li><p>Для перехвата catch() промисов необходимо возвращать промис:</p>
<p> Верно:</p>
<pre><code class="lang-js">     loginToken = function (token) {
             this.cleanUserLocalData();
             return userService.getByToken(token)
                     .then(user =&gt; {
                         return Promise.resolve(this.setUserLocalData(user));
                     })
                     .catch(error =&gt; {
                         return Promise.reject(error);
                     });
         };

     loginToken(authService.getToken())
                             .then(user =&gt; {
                             })
                             .catch(error =&gt; {
                                 });

</code></pre>
<p> НеВерно:</p>
<pre><code class="lang-js">     loginToken = function (token) {
             this.cleanUserLocalData();
             return userService.getByToken(token)
                     .then(user =&gt; {
                         return this.setUserLocalData(user);
                     })
                     .catch(error =&gt; {
                         return error;
                     });
         };

     loginToken(authService.getToken())
                             .then(user =&gt; {
                             //пойдёт тут даже при loginToken.reject
                             })
                             .catch(error =&gt; {
                              });
</code></pre>
</li>
<li><p>Если для одинарного показа модального окна необходимо перед вызовом функции показа записывать 
 <code>localStorage.setItem(&#39;isModalXYZOpenedOnce&#39; , &#39;1&#39;)</code>, то необходимо 
добавить в <code>authService.cleanUserLocalData --&gt; localStorage.removeItem(&#39;isModalXYZOpenedOnce&#39;)</code>. 
Т.к. после логина нового пользователя он может быть уже другим даже на одном и том же браузере.</p>
</li>
<li><p>Использовать вызовы сервисов вместо прямого доступа к переменным. Это сокращает код.
 <code>authService.getUserLocalData().typeName</code> вместо $rootScope.user.typeName</p>
</li>
<li><p>Дублированный код необходимо переносить в отдельный сервис/функцию.</p>
</li>
<li><p>Использовать для отображения и логгирования ошибок errorService: <code>src/app/common/services/error-service.js</code>:</p>
<p> Пример:</p>
<pre><code class="lang-js">         errorService.error(
        error,
        &#39;Ошибка при сохранении позиции applicantService.positionName&#39;,
        {isUseLogger: true},
        &#39;warning&#39;,
        &#39;src/app/applicant/profile/profile-controller.js&#39;,
        &#39;initUser.openModalOnMouseLeave--&gt;applicantService.update&#39;,
        &#39;PG-1481&#39;
   );
   $rootScope.$emit(&#39;error.event&#39;, {
           objError: err,
           additionalDescription: &#39;Ошибка при сохранении позиции applicantService.positionName&#39;,
           responseOnError: {
               isUseNotify: true
           },
           level: &#39;error&#39;,
           file: &#39;app/v2/page/main/main-page/main-page-controller.js:113&#39;,
           method: &#39;main-page.authService.login&#39;,
           bugRelated: &#39;&#39;
   });
   errorService.error(
        {},
        &#39;Пожалуйста введите корректные данные&#39;,
        {isUseModal: true},
    )
</code></pre>
</li>
<li>Использовать для конструкций вида:<pre><code class="lang-js"> if (applicant &amp;&amp; applicant.relations &amp;&amp; applicant.relations.login &amp;&amp; typeof(applicant.relations.login.loginCount) === &#39;number&#39; &amp;&amp;
       applicant.relations.login.loginCount === 2) {}
</code></pre>
 Сервис dataTypeService, который позволяет с помощью метода safeCheck, привести к такому виду:<pre><code class="lang-js">       if(dataTypeService.safeCheck(applicant, &#39;relations.login.loginCount&#39;, dataTypeService.NUMBER, -1) === 2) {}
</code></pre>
</li>
<li>Значения по-умолчанию для переменных, в случае, если их не определили:<pre><code class="lang-js">     const NUMBER_DEFAULT = -1;
     const BOOLEAN_DEFAULT = false;
     const STRING_DEFAULT = &#39;&#39;;
     const ARRAY_DEFAULT = [];
</code></pre>
 Необходимо учитывать при составлении названий переменных</li>
</ol>
