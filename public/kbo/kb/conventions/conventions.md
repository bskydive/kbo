# Соглашения

Предлагаю совместными усилиями навести порядок в нашем коде.
Это сделает нашу производительность труда чуть больше, чем сейчас, а также снизит объём работы.

## Цели соглашений

1. Удобство миграции кода. Необходимо облегчить процесс переноса кода между старым и новым дизайном/фреймворком.

1. Удобство отладки кода. Необходимо глядя в devTools сразу понимать из какого файла этот кусок кода, где он может находиться внутри файла.

1. Удобство чтения. Необходимо сокращать время поиска и анализа информации.
	При взгляде на переменную или функцию необходимо сразу понимать что она должна делать.

1. Удобство разработки. Необходимо использовать общепринятые шаблоны и практики, сокращать код.
	Меньше кода - меньше ошибок, конфликтов версий кода, быстрее чтение кода.
	Нежелательно сокращать переносы строк или названия, т.к. минификатор их и так уберёт, а скорость чтения кода упадёт.
	Максимальная длинна строк регулируется в соглашениях.

1. Наследие. [Сохраняйте](https://blog.juliobiason.me/thoughts/things-i-learnt-the-hard-way/) [потраченное время](https://habr.com/ru/company/mailru/blog/456862/) и делитесь им.

## Русский язык

* [glavred](https://glvrd.ru/) - проверка качества текста
* https://languagetool.org/
* [платный](https://orfogrammka.ru), с объяснением правил и проверкой на заимстовованные слова
* https://www.artlebedev.ru/orfograf/
* http://online.orfo.ru/
* https://text.ru/spelling/unauthorized
* https://www.artlebedev.ru/typograf/ - пробелы, переносы, кавычки, тире
* http://grammarly.com/ - с плагинами

### Англо-русский словарь

Для улучшения взаимопонимания в команде и экономии времени на поиск.
Зачастую люди не понимают смысла английских слов, или не знают перевода русских.
 * [словарик 1](https://github.com/web-standards-ru/dictionary/blob/master/dictionary.md)
 * [словарик 2](http://www.paratype.ru/help/term/)
 * [контекстный словарь](https://context.reverso.net/translation/english-russian/)
 * [словарь](https://multitran.org)
 * [национальный корпус русского языка](https://ruscorpora.ru/new/search-para-en.html)


 | Eng | в прямом переводе | в контексте разработки |
 | --- | --- | --- |
 | issue | проблема | задача. по-разному понимается во многих контекстах. |
 | conventions | соглашения | |
 | collaboration, teamwork | сотрудничество, совместная работа | |
 | feature | особенность | полезная особенность |
 | feedback | отзыв | обратная связь |
 | hype | ажиотаж, шумиха, манипуляция | |
 | merit | заслуга | |
 | edge case | исключительный случай | |
 | time slot | временное окно | |
 | prohibit, deny | запрещать | |
 | overwhelmed, impressed | ошеломлённый | |
 | keen, interested in | заинтересован | |
 | convince | убеждать | |
 | implicit | неявный | |
 | explicit | явный | |
 | assertion | утверждение | |
 | intrinsic | принадлежащий | |
 | observable | обозреватель | сборщик |
 | feedback | отзыв | оценка |
 | eagerly | нетерпеливо | принудительно |
 | scope | охват | область видимости |
 | entity | сущность, экземпляр объекта | |
 | binding | связывание, назначение | |
 | callback | возврат | обратный вызов |
 | namespace | пространство имён | |
 | gullible | доверчивый | |
 | Roughly speaking | грубо говоря | |
 | bounds | границы | |
 | lack | нехватка | |
 | Thus | соответственно | |
 | crucial | ключевой | |
 | grasp | ухватить суть | усвоить |
 | peculiar | характерный | |
 | bears repeating | основательно повторим | |
 | conveys | передавать | |
 | infer | предполагать | |
 | mockup | имитация | макет |
 | coercion | приведение |  |
 | driven | ведомые | ориентированные |
 | perceive | воспринимаемый |  |
 | debounce | антидребезг | отсечка, сглаживание |
 | throttle | дроссель | ограничитель |
 | spread | расщепление |  |
 | guide | наставление |  |
 | tab |  | вкладка |
 | select box |  | выпадашка |
 | check box |  | галка |
 | radio box |  | точка |
 | input | поле ввода | ввод, поле |
 | caption, label |  | надпись |
 | hover |  | наведение |
 | overlap |  | перекрытие |
 | fallback | резервный, запасной |  |
 | shallow | поверхностный |  |
 | reducer | редуктор | конвертер |
 | dispatch |  | отправка |
 | flow |  | жизненный цикл |
 | section | раздел | структура |
 | injection |  | внедрение(зависимостей) |
 | pipe |  | конвейер |
 | slice | ломтик, срез | фрагмент |
 | inconsistent | нелогичный | несогласованный |
 | consistent | логичный | согласованный |
 | Maintainability |  | поддерживаемость |
 | Loose coupling |  | слабая связность |
 | Tight coupling |  | сильная связность |
 | boilerplate |  | заготовка, болванка |
 | holywar | священная война | горячий спор, горячая спорная тема |
 | function expression |  | функциональное выражение |
 | function declaration |  | объявляемая функция |
 | end-to-end |  | сквозной |
 | disclose |  | раскрывать |
 | burden |  | обуза |
 | perseption |  | представление |
 | aware |  | осознавать |
 | be aware |  | примите к сведению |
 | beware |  | остерегаться |
 | awareness |  | осведомлённость |
 | lurking |  | притаиться |
 | jeopardize |  | ставить под удар |
 | utmost |  | предельно |
 | posession |  | владение |
 | rigorous |  | строгий |
 | confuze |  | путать |
 | vigilance |  | бдительность |
 | harmless |  | безвредный |
 | ploy |  | хитрость |
 | disposal |  | уничтожение |
 | surplus |  | излишки |
 | appraisal |  | заключение |
 | inquiry |  | обследование |
 | distinct |  | отчётливый |
 | charitable |  | снисходительный |
 | honest |  | честный |
 | asset | ценный актив | ресурс |
 | judgement |  | обоснование |
 | conduct |  | руководство |
 | excellence |  | совершенство |
 | raise |  | повышение |
 | faith |  | вера |
 | concerns | причиндалы | затруднения |
 | encourage |  | вдохновлять |
 | retaliate |  | отплатить |
 | fair |  | добросовестный |
 | modest |  | небольшой |
 | reasonable |  | адекватный |
 | abide |  | придерживаться |
 | competitor |  | соперник |
 | modestly |  | скромно |
 | stationery |  | канцелярские принадлежности |
 | retain |  | удерживать |
 | disclosure |  | раскрытие |
 | obligate |  | обязать |
 | intention |  | намерение |
 | intentional |  | преднамеренный |
 | compliance | соответствие стандартам | стандарт |
 | evaluation |  | аттестация |
 | involve |  | вовлекать |
 | denote |  | обозначать |
 | intervene |  | вмешиваться |
 | hesitate |  | стесняться |
 | force |  | принуждать |
 | regret |  | сожалеть |
 | strive |  | стремиться |
 | endure |  | перетерпеть |
 | reimbursable |  | оплачиваемый |
 | least |  | наименьший |
 | effort |  | попытка |
 | reliable |  | надёжный |
 | unreliable |  | ненадёжный |
 | conceal |  | прятать |
 | substitute |  | заменитель |
 | essence |  | сущность |
 | essentials |  | сущность |
 | essentials |  | существенный |
 | trail |  | след |
 | contradictory |  | противоречивый |
 | severity |  | важность |
 | Containment |  | изоляция |
 | Defect Containment Effectiveness |  | Эффективность изоляции дефектов |
 | flaw |  | дефект |
 | slippery |  | ускользающий |
 | intermittent error |  | плавающая ошибка |
 | embrace |  | осваивать |
 | disparity |  | диспропорция |
 | domain area |  | предметная область |
 | refinement |  | уточнение |
 | stakeholder | акционер | заинтересованное лицо, владелец бюджета |
 | crucial |  | решающий |
 | lifehack | хитрость | полезный совет |
 | book |  | забронировать, зарезервировать |
 | newcomer |  | новичок |
 | onboarding | адаптация |  |
 | pattern |  | закономерность, правило |
 | span | пролёт |  |
 | responsive | отзывчивый | адаптивный |
 | deploy | развёртывание |  |
 | Scheduler | диспетчер | планировщик |
 | share | распространять | делиться |
 | shared | общий, общедоступный |  |
 | claim | требование/заявка |  |
 | chaining | сцепление | звеньевание, паровозик |
 | standalone | автономный |  |
 | roadmap | дорожная карта | эскизный план, план-график |
 | checklist | список действий | памятка, контрольный список |
 | invariant | инвариант | неопределённость, отклонения |
 | wellbeing | благополучие |  |
 |  |  |  |
 |  |  |  |  |

## Шаблоны и практики

1. [DRY](https://ru.wikipedia.org/wiki/Don%E2%80%99t_repeat_yourself)
1. [KISS](https://ru.wikipedia.org/wiki/KISS_%28принцип%29)
1. [JSDOC](http://usejsdoc.org/)
1. https://basecamp.com/books/getting-real
1. https://www.yegor256.com/2014/04/17/how-xdsd-is-different.html
1. https://en.wikipedia.org/wiki/Extreme_programming
1. https://en.wikipedia.org/wiki/Scrum_(software_development)
1. https://wemake.services/meta/rsdp
1. https://www.sonarsource.com/docs/CognitiveComplexity.pdf

## Соглашения с Бизнесом

1. Необходимо договариваться и фиксировать ограничения совестимости кода.
	При этом, необходимо обосновывать с точки зрения ЦА/Бизнеса ценность каждого параметра охвата, т.к. это сильно экономит время разработки.
	На живом проекте, при наличии метрик можно точно оценить потребность в ограничениях.

 	Например:
 	* iphone, android, desktop
 	* ios 10+, android6+, Windows7+
 	* chrome 59+, firefox 52+, ie 11+
 	* ширина дисплея: 375, 768, 992, 1200

## Организация кода

1. По возможности сразу определите единый стиль отступов. Табуляция позволяет разным людям видеть код так, как им удобно, а более того, на разных устройствах/IDE по-разному. Те, кто предпочитают пробелы всё равно ставят их табом через автозамену или автоформатом IDE. Наиболее популярные стили кода и отступов, судя по всему, написаны с учётом унаследованного кода из времён проблем с размером мониторов и кодировкой. Кроме того, более старые стили кода [позволяют](https://wiki.sc/wikipedia/Отступ_(программирование)#Стиль_«K&R») использовать смешанные отступы.

1. Используется единое пространство имён, чтобы понимать для каких компонентов в других видах файлов написан кусок кода.
	Все подписи коммитов, компоненты, переменные, папки, классы должны содержать одинаковые слова для обозначения одинаковых или взаимосвязанных элементов.
	Одинаковые слова должны быть описаны в справочнике, связывающем между собой бизнес-понятия, вёрстку, код, дизайн.
	Менеджер, дизайнер, программист и тестировщик должны одинаково понимать эти слова.

1. Правила именования должны облегчать рефакторинг, чтобы можно было за один раз легко менять названия.
	Пример:
	```
		formControlUserName
		formControlUserRole
		getErrorTextUserName
		sendUser
		loadUser
		addUser
	```

1. Код организуется в иерархические папки-компоненты. Каждый компонент содержит js+less+jade код в одной папке.
	Внутри указываются относительные пути до файлов для удобства миграции кода.

1. Страница разбивается на блоки и компоненты. Общая задача разбивается на подзадачи по блокам и компонентам. Сначала делаем модуль с маршрутом и страницами-заглушками
	под каждую подзадачу, затем реализуем все компоненты, потом собираем блоки. На странице необходимо вставить все компоненты и блоки, вывести в консоль
	оповещения о старте init() каждого контроллера.	На странице-заглушке вывести в заголовках h4-h5 названия задач в JIRA, связанные с каждым компонентом,
	чтобы дизайнер мог после просмотра компонента сделать комментарии в нужной подзадаче.

1. Картинки хранятся в отдельной папке для всех картинок с подпапками по страницам/экранам

1. Шрифты хранятся в отдельной папке для всех шрифтов, с подпапками для каждого шрифта. В подпапке также хранится файл less для @font-face шрифта.

1. Необходимо убирать лишний код и [комментарии](https://habr.com/ru/company/mailru/blog/349978/) при рефакторинге. Главные комментарии пишутся в jsDoc перед методами и в начале файла.
	* Если комментарии необходимо временно оставить, то заводим задачу в JIRA в истории про рефакторинг.
	* Указываем в задаче ссылку на место в коде с временным комментарием.
	* Указываем в комментарии в коде ссылку на задачу JIRA
1. При именовании объектов необходимо давать самодокументируемые названия, и прикрывать все выходы и входы интерфейсами. Должно быть как можно меньше одинаковых названий, иначе при комбинированни данных вырастает риск ошибки подмены данных пользователя, т.к. легко перепутать first.params[].id и second.id при объединении их в один объект.А вот firstId и secondId легче защитить интерфейсами.

```ts
	setProfile(){
		if (
			typeof this.profile.dataModified.profileId === string &&
			this.profile.dataModified.profileId.length > 0 &&
			typeof this.profile.dataModified.profileNotes === string &&
			typeof this.profile.dataModified.login === string &&
			typeof this.profile.dataModified.role === string &&
		){
		return this.api.call.setProfile.run({
					loaderTriggerVarName: 'isLoading', context: this.loader, token: this.auth.getTokenSync(), errorVarName: 'loadingErrorText',
					requestParams: {
						profileId: this.profile.dataModified.profileId,
						profileNotes: this.profile.dataModified.profileNotes,
						login: this.profile.dataModified.login,
						role: this.profile.dataModified.role,
					} as IProfileUpdateParams
					});
		} else {
			this.errorService.log({
				data: {profile: this.profile},
				desc: 'Валидатор не одобряэ',
				src: '/src/app/main/profile/profile.component.ts:111',
				mtd: 'setProfile'
			});
		}
	}
```

1. Тестовые данные должны помогать документировать и тестировать код. Достаточно привести к самодокументируемым данные одного дерева объекта для тестирования.
	```js
		itemId:'номер-элемента-11'
		itemNotes:'Заметки для элемента 11'
		itemName:'Название элемента 11'
	```
1. Создание компонента начинается с модели данных, чтобы на старте понять возможные ограничения и возможности, под которые будет сделан интерфейс и сервисы. Также можно добавить *_RAW параметры и данные, если модель на сервере не соответствует соглашениям об именовании или требует конвертирования. Например, устарела или использует даты в собственном формате. Лучше переложить как можно больше конвертирования данных в модель, чтобы разгрузить DOM/события, и уменьшить объём кода там, где его больше всего - в компонентах. Запятая в завершающей строке облегчает работу в колоночном режиме.

```ts
	/**
	* Общий тип для описаний ключей объектов: надписей
	*/
	export interface IDescription {
		[keyName: string]: string;
	}
	//=========================REQUEST
	/**
	* Параметры для запроса REQNAME в формате сервера
	*/
	export interface IReqNameParamsRaw {
		request: string;
		identity: number;
	}
	/**
	* Пустые значения параметров для запроса REQNAME в формате сервера
	* Для универсальной проверки на пустые данные и их очистки
	*/
	export const REQNAME_PARAMS_RAW_DEFAULT:IReqNameParamsRaw = {
		request: 'reqName',
		identity: -1,
	}

	/**
	* Параметры для запроса REQNAME
	*/
	export interface IReqNameParams {
		id: string;
	}
	/**
	* Описание параметров для запроса REQNAME
	* Для генерируемого DOM интерфейса построения запросов
	*/
	export const REQNAME_PARAMS_DESC:IDescription = {
		id: 'Номер',
	}
	/**
	* Пустые значения параметров для запроса REQNAME
	* Для универсальной проверки на пустые данные и их очистки
	*/
	export const REQNAME_PARAMS_DEFAULT:IReqNameParams = {
		id: '',
	}

	//=========================RESPONSE
	/**
	* Данные с сервера  данных REQNAME в формате сервера
	* Happiness:'1'|'0'
	*/
	export interface IReqNameRaw {
		Identity: number;
		Name: string;
		Date: string;
		Happiness: string;
	}

	/**
	* Пустые значения параметров данных REQNAME в формате сервера
	* Для универсальной проверки на пустые данные и их очистки
	*/
	export const REQNAME_RAW_DEFAULT:IReqNameRaw = {
		Identity: -1,
		Name: '',
		Date: '',
		Happiness: '',
	}

	/**
	* Данные с сервера данных REQNAME
	* следовать REQNAME не обязательно, т.к. название типа/интерфейса должно быть говорящим, самодокументируемым
	* Для универсальной проверки на пустые данные и их очистки
	* date строкового типа, чтобы можно было присваивать как unix, так и человекочитаемое значение, для экономии и гибкости кода на старте проекта
	* id необходимо возвращать с сервера при любом виде запроса для будущего расширения функционала, передачи идентификатора в другие запросы
	*/
	export interface IReqName {
		id: string;
		name: string;
		date: string;
		isHappy: boolean;
	}

	/**
	* Описание параметров данных REQNAME
	* Для генерируемого DOM интерфейса построения запросов
	*/
	export const REQNAME_DESC:IDescription = {
		id: 'Номер',
		name: 'Имя',
		date: 'Дата',
		isHappy: 'Счастье',
	}
	/**
	* Список ключей параметров данных REQNAME
	* Для генерируемого DOM интерфейса, т.к. *ngFor не умеет итерировать объекты
	*/
	export const REQNAME_DESC_KEYS = [
		'name',
		'date',
		'isHappy',
	]
	/**
	* Пустые значения параметров данных REQNAME
	* Для универсальной проверки на пустые данные и их очистки
	*/
	export const REQNAME_DEFAULT:IReqName = {
		id: '',
		name: '',
		date: '',
		isHappy: false,
	}

```
1. Для вложенных типов данных предпочтительнее использовать объекты вместо массивов, т.к. внутрь можно вложить дополнительные свойства, например, isExpanded. Вложенные списки лучше делать массивами, т.к. *ngFor не умеет итерировать объекты.
1. Необходимо сразу писать сервисы для кэширования данных от сервера вместо сервисов отдачи данных из api. Рано или поздно часть данных придётся переиспользовать в нескольких экранах, и это создаст сложности с производительностью и рефакторингом.
1. Для предотвращения петель на событиях и наблюдателях необходимо рисовать схему взаимодействия компонентов. Определить закольцовывание крайне тяжело. Заметные потери производительности и мутации данных начинаются слишком поздно, чтобы их быстро исправить.
1. Для улучшения производительности необходимо импортировать внешние модули типа loDash/MomentJs в отдельный сервис. В компонентах и сервисах необходимо использовать методы-обёртки вместо прямого импортирования бочек(barrel import) *.

## Управление задачами

1. фиксировать в соотв задаче jira временные решения до момента рефакторинга. Описывать файл, строку, приводить скрин кода для рефакторинга временного решения.
	Для этих задач есть общая история под версию 1.3 [Рефакторинг]()

1. Для каждого временного решения в коде указывать todo, а также ссылку на задачу в JIRA для рефакторинга

1. Каждая задача JIRA не должна превышать 8 часов в работе

1. Перед(!!!ПЕРЕД!!!) началом выполнения работы по задаче JIRA необходимо поставить оценку в story points.
	Это условная единица, которая при делении на фактически затраченное время позволяет делать более точные прогнозы по времени выполнения.

1. Для каждой задачи отпочковывается отдельная ветка в репозитории. Родительская ветка: release/dev. Тогда все коммиты прилетают в релиз одним мерджем, их легко откатывать в релизе, и легко исследовать внутри ветки.

1. После выполнения какой-либо части работ обязательно делается commit и push в соответствующую ветку.

1. После завершения работ над задачей делается [пулреквест(запрос о слиянии)](https://habr.com/ru/company/mailru/blog/359246/) в ветку релиза.

1. После тестирования ветки релиза делается запрос слияния с веткой продуктива.

1. Через неделю или сразу после слияния ветки релиза в продуктив удаляются все ветки задач релиза.

1. В комментарий к каждому коммиту обязательно пишется номер задачи и расположение изменений(блок/страница/модуль).
	После удаления ветки должен остаться не только номер задачи, который ещё надо найти и загрузить в браузере.
	Словесное описание позволяет быстро понять охват изменений даже при наведении на аннотации к коду.

	Пример:
	* APP-0000-landing-page-comfort
	* APP-0000-footer-icons-refactoring
	* APP-0000-modal-register-recruiter-fix

1. Замечания и вопросы по задачам делаются обязательно в задаче JIRA.

1. Длинные обсуждения ведутся в общих чатах по темам(front, backend, web-design, test).
	Это позволяет сохранить экспертизу, а также вмешиваться заинтересованным лицам *ДО* того, как произойдёт нечто неприятное.

1. Итоги обсуждения в общих чатах обязательно фиксируются в задаче JIRA.
	Обсуждать сразу весь пакет замечаний вместо беседы по отдельным блокам/задачам - значит терять время.
	Каждую задачу можно отправлять после обсуждения на тестирование или доработку конкретному сотруднику.
	Например, дизайнеру. После доработки в конкретной задаче появятся, например, новые исправленные макеты.
	Кроме этого, появятся трудозатраты, которые впоследствии помогут более точно прогнозировать сроки.
	Кроме прогноза бывает интересно узнать почему задача выполнялась так долго.

1. Если в результате выполнения задачи реализация отличается от ТЗ, это необходимо указать в комментариях, с указанием причин такого решения.
